{% extends "base.html" %}

{% block styles %}
  {{ super() }}
  <link rel="stylesheet" type="text/css"
  href="{{ url_for('bower.static', filename='clusterize/clusterize.css') }}" />
  <link rel="stylesheet" type="text/css"
  href="{{ url_for('bower.static', filename='datatables/media/css/jquery.dataTables.min.css') }}" />
  <style>
  .table-sm tr, th, td {
    height : 15px;
    font-size: small;
    margin: 0 0 0 0;
  }
  </style>
{% endblock %}

{% block content %}
  {{ super() }}
  <div class="container-fluid">
      {% if channel_id %}
        {% set channel = hyperstream.channel_manager[channel_id] %}
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              {{ channel_id }}
            </h4>
            <p>{{ channel.__class__.__name__ }}</p>
            <p></p>
          </div>
          <div class="panel">
            <div class="panel-body" width="100%">
              <div id="contentArea" class="clusterize-content" width="100%">
                <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                   <thead>
                     <tr>
                       {% for key in table.keys() %}
                         {% if key not in ['s.meta_data', 's.c_id'] %}
                           <th>{{ key }}</th>
                         {% endif %}
                       {% endfor %}
                     </tr>
                   </thead>
                   <tbody>
                     {% for i in range(table.itervalues().next() | length) %}
                       {% set meta_data = dict(table['s.meta_data'][i]) %}
                       {% set href = url_for('streams', channel=channel_id, name=table['s.name'][i], **meta_data) %}
                       <tr>
                         {% for key in table.keys() %}
                           {% if key == 's.name' %}
                             <td><a href="{{ href }}">{{ table[key][i] }}</a></td>
                           {% elif key not in ['s.meta_data', 's.c_id'] %}
                             <td>{{ table[key][i] }}</td>
                           {% endif %}
                         {% endfor %}
                       </tr>
                     {% endfor %}
                   </tbody>
                </table>
              </div>
          </div>
        </div>
      {% else %}
        {% for channel in channels_descr %}
        <div class="col-lg-3">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">
                <a href="{{ url_for('mpn_channels', channel_id=channel.id) }}">{{ channel.id }}</a>
              </h4>
            </div>
            <div class="panel-body">
              <p><strong>Type: </strong>{{ channel.name }}</p>
              <p><strong>Number of streams:</strong> {{ channel.len }}</p>
            </div>
          </div>
        </div>
        {% endfor %}
      {% endif %}
    </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="text/javascript" src="{{ url_for('bower.static', filename='clusterize/clusterize.js') }}"></script>
  <script type="text/javascript" src="{{ url_for('bower.static', filename='datatables/media/js/jquery.dataTables.min.js') }}"></script>

  {% if channel_streams %}
  <script type="text/javascript">
    if (true) {
      // Temporarily disable clusterize
      var clusterize = new Clusterize({
        //rows: filterRows(rows),
       scrollId: 'scrollArea',
       contentId: 'contentArea',
       rowsInBlock: 200
      }
      );
    }
  </script>

  <script type="text/javascript">
    $(document).ready(function() {
        $('#example').DataTable();
    } );
  </script>
  {% endif %}
{% endblock %}
